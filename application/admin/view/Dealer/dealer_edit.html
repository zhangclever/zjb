{include file='public/link-css'}
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap-fileupload.css"/>
<!-- BEGIN BODY -->
<body class="page-header-fixed">
<!-- BEGIN HEADER -->
{include file='public/header'}
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container row-fluid">
    <!-- BEGIN SIDEBAR -->
    {include file='public/left-menu'}
    <!-- END SIDEBAR -->
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
        <div id="portlet-config" class="modal hide">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button"></button>
                <h3>Widget Settings</h3>
            </div>
            <div class="modal-body">
                <p>Here will be a configuration form</p>
            </div>
        </div>
        <!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                    <!-- BEGIN VALIDATION STATES-->
                    <div class="portlet box green">
                        <div class="portlet-title">
                            <div class="caption"><i class="icon-reorder"></i>经销商信息修改</div>
                            <div class="tools">
                                <a href="javascript:;" class="collapse"></a>
                            </div>
                        </div>
                        <div class="portlet-body form ">
                            <!-- BEGIN FORM-->
                            {volist id='di' name='dealer_info'}
                            <form action="{:url('Dealer/dealer_info_edit')}" id="form_sample_2" method="post"
                                  class="form-horizontal" enctype="multipart/form-data">
                                <div class="control-group">
                                    <div class="controls" data-toggle="tooltip">
                                        <label class="control-label">经销商姓名<span class="required">*</span></label>
                                        <input type="hidden" name="id" value="{$di.id}">
                                        <input type="text" name="dname" data-required="1" class="span4 m-wrap"
                                               value="{$di.dname}"/>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">性别<span class="required">*</span></label>
                                        <div class="controls controls-row" style="margin-left: 250px;">
                                            <label class="radio">
                                                <input type="radio" name="dsex" value="0" {$di.dsex==0 ? 'checked':''} />
                                                男
                                            </label>
                                            <label class="radio">
                                                <input type="radio" name="dsex" value="1" {$di.dsex==1 ? 'checked':''} style="margin-left: 50px"/>
                                                女
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">正面照片<span class="required">*</span></label>
                                        <div class="fileupload fileupload-new" data-provides="fileupload">
                                            <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;">
                                                <img src="__PUBLIC__/{$di.dpath}/{$di.dimg}" alt=""/>
                                            </div>
                                            <div class="fileupload-preview fileupload-exists thumbnail"
                                                 style="max-width: 200px; max-height: 150px; line-height: 20px;"></div>
                                            <div style="margin-left: 210px;">
													<span class="btn btn-file"><span class="fileupload-new">添加图片</span>
													<span class="fileupload-exists">重选</span>
													<input type="file" class="default" name="dealerimg"/></span>
                                                <a href="#" class="btn fileupload-exists"
                                                   data-dismiss="fileupload">移除</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls" data-toggle="tooltip">
                                        <label class="control-label">身份证号<span class="required">*</span></label>
                                        <input type="text" name="dcardnum" data-required="1" class="span4 m-wrap"
                                               value="{$di.dcardnum}"/>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">身份证<span class="required">*</span></label>
                                        <div class="fileupload fileupload-new" data-provides="fileupload">
                                            <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;">
                                                <img src="__PUBLIC__/{$di.dpath}/{$di.dcdimg}" alt=""/>
                                            </div>
                                            <div class="fileupload-preview fileupload-exists thumbnail"
                                                 style="max-width: 200px; max-height: 150px; line-height: 20px;"></div>
                                            <div style="margin-left: 210px;">
													<span class="btn btn-file"><span class="fileupload-new">添加图片</span>
													<span class="fileupload-exists">重选</span>
													<input type="file" class="default" name="dealercardimg"/></span>
                                                <a href="#" class="btn fileupload-exists"
                                                   data-dismiss="fileupload">移除</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">手机号<span class="required">*</span></label>
                                        <input name="dmobel" type="text" class="span4 m-wrap" value="{$di.dmobel}"/>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">所属地区<span class="required">*</span></label>
                                        <select name="province" id="province" class="span2 m-wrap">
                                            <option value="" class="span2 m-wrap">{$di.province}</option></select>
                                        <select name="city" id="city" class="span2 m-wrap">
                                            <option value="" class="span2 m-wrap">{$di.city}</option>
                                        </select>
                                        <select name="district" id="district" class="span2 m-wrap">
                                            <option value="" class="span2 m-wrap">{$di.district}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">所属经销商<span class="required">*</span></label>
                                        <select class="span2 m-wrap" name="manager">
                                            <option value="{$di.manager}">{$di.mname}</option>
                                            {volist name='manager_info' id='ma'}
                                            <option value="{$ma.id}">{$ma.mname}</option>
                                            {/volist}
                                        </select>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="controls">
                                        <label class="control-label">管理密码<span class="required">*</span></label>
                                        <input type="password" class="span3 " name="dpassword" value="">
                                    </div>
                                </div>
                                <div class="form-actions text-center">
                                    <button type="submit" class="btn green">提交</button>
                                    <button type="button" class="btn default" id="back">取消</button>
                                </div>
                            </form>
                            {/volist}
                            <!-- END FORM-->
                        </div>
                    </div>
                    <!-- END VALIDATION STATES-->
                </div>
            </div>
        </div>
        <!-- END PAGE CONTAINER-->
    </div>
    <!-- BEGIN PAGE -->
</div>
<!-- END CONTAINER -->
<!-- BEGIN FOOTER -->
{include file='public/footer'}
<!-- END FOOTER -->
</body>
{include file='public/script-js'}
<script type="text/javascript" src="__PUBLIC__/js/bootstrap-fileupload.js"></script>
<script src="__PUBLIC__/js/address.js"></script>
<script>
    $('#form_sample_2').submit(function () {         //使用ajax的submit提交方法进行表单提交
        $(this).ajaxSubmit(function (res) {
            if (res.code === 1) {
                layer.msg(res.msg, {icon: 6, time: 2300}, function () {
                    location.href = res.url;
                })
            } else {
                layer.msg(res.msg, {icon: 2, time: 2300}, function () {
                    location.href = res.url;
                })
            }

        });
        return false; //阻止表单默认提交
    });
    $('#back').on('click', function () {
        location.href="{:url('Dealer/dealer_list')}";
    })
</script>
<script>
    $(function () {
        var html = "";
        $("#city").append(html); $("#input_district").append(html);
        $.each(pdata,function(idx,item){
            if (parseInt(item.level) == 0) {
                html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
            }
        });
        $("#province").append(html);
        $("#province").change(function(){
            if ($(this).val() == "") return;
            $("#city option").remove(); $("#district option").remove();
            var code = $(this).find("option:selected").attr("exid"); code = code.substring(0,2);
            var html = "<option value=''>--请选择--</option>"; $("#district").append(html);
            $.each(pdata,function(idx,item){
                if (parseInt(item.level) == 1 && code == item.code.substring(0,2)) {
                    html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                }
            });
            $("#city").append(html);
        });
        $("#city").change(function(){
            if ($(this).val() == "") return;
            $("#district option").remove();
            var code = $(this).find("option:selected").attr("exid"); code = code.substring(0,4);
            var html = "<option value=''>--请选择--</option>";
            $.each(pdata,function(idx,item){
                if (parseInt(item.level) == 2 && code == item.code.substring(0,4)) {
                    html += "<option value='" + item.names + "' exid='" + item.code + "'>" + item.names + "</option>";
                }
            });
            $("#district").append(html);
        });
    });
</script>
</html>